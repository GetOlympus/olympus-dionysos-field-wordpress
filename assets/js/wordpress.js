!function(i,l){"use strict";function e(o,t){var e=this;l&&l.template&&(e.$el=o,e.options=t,e.$elements=e.$el.find(e.options.elements),e.$addbutton=e.$el.find(e.options.addbutton),e.$submitbox=e.$addbutton.parent(),e.$modal=e.$el.find("#"+e.options.modal+"-modal"),e.$overlay=e.$el.find(e.options.overlay),e.$addbutton.on("click",i.proxy(e.add_block,e)),e.$elements.find(e.options.editbutton).on("click",i.proxy(e.edit_block,e)),e.$elements.find(e.options.removebutton).on("click",i.proxy(e.remove_block,e)),e.update_buttons())}e.prototype.$addbutton=null,e.prototype.$current=null,e.prototype.$el=null,e.prototype.$elements=null,e.prototype.$modal=null,e.prototype.options=null,e.prototype.$overlay=null,e.prototype.$submitbox=null,e.prototype.add_block=function(o){o.preventDefault();var t=this,e=l.template(t.options.source),n=i(e({id:""}));n.find(t.options.editbutton).on("click",i.proxy(t.edit_block,t)),n.find(t.options.removebutton).on("click",i.proxy(t.remove_block,t)),t.$elements.append(n),t.update_buttons()},e.prototype.edit_block=function(o){o.preventDefault();var t=this,e=i(o.target||o.currentTarget).closest(t.options.item);t.$current=e,t.$modal.hasClass("initialized")||t._modal_init(),t._modal_open()},e.prototype.remove_block=function(o){o.preventDefault();var t=this,e=i(o.target||o.currentTarget).closest(t.options.item);e.css("background",t.options.color),e.animate({opacity:"0"},"slow",function(){e.remove(),t.update_buttons()})},e.prototype.update_buttons=function(){var o=this,t=o.$elements.find(o.options.item).length;1<=t&&!o.options.multiple&&o.$submitbox.hide(),t&&!o.options.multiple||o.$submitbox.show()},e.prototype._modal_close=function(){var o=this;o.$modal.find("."+o.options.modal+"-response").empty(),o.$modal.hide(),o.$overlay.hide()},e.prototype._modal_init=function(){var l=this;l.$overlay.on("click",i.proxy(l._modal_close,l)),l.$modal.find("."+l.options.modal+"-input").focus().keyup(function(o){27==o.which&&l._modal_close()}),l.$modal.find("."+l.options.modal+"-input").keypress(function(o){if(13==o.which)return l._modal_send_request(),!1}),l.$modal.find("."+l.options.modal+"-submit").click(function(o){o.preventDefault();var t=l.$modal.find("."+l.options.modal+'-response input[type="radio"]:checked');if(t.length){var e=t.val(),n=t.closest("tr").find("td.title").attr("data-l"),i=t.closest("tr").find("td.title").text();l.$current.find('input[type="hidden"]').val(e),l.$current.find(l.options.linkurl).attr("href",n),l.$current.find(l.options.linkurl).text(n),l.$current.find(l.options.linklabel).text(i),l._modal_close()}}),l.$modal.find("."+l.options.modal+"-search").on("click",i.proxy(l._modal_send_request,l)),l.$modal.find("."+l.options.modal+"-close").on("click",i.proxy(l._modal_close,l)),l.$modal.addClass("initialized")},e.prototype._modal_open=function(){var o=this;o.$overlay.show(),o.$modal.show(),o._modal_send_request()},e.prototype._modal_send_request=function(){var o=this,t={search:o.$modal.find("."+o.options.modal+"-input").val(),type:"post",action:o.options.modal},e=o.$modal.find("."+o.options.modal+"-spinner");e.addClass("is-active");var n=o.$modal.find("."+o.options.modal+"-response");i.ajax(ajaxurl,{type:"POST",data:t,dataType:"json"}).always(function(){e.removeClass("is-active")}).done(function(o){o.success||n.text(attachMediaBoxL10n.error),n.html(o.data)}).fail(function(){n.text(attachMediaBoxL10n.error)})};var t={init:function(o){if(!this.length)return!1;var t={color:"#ffaaaa",elements:".listbox",item:"fieldset",multiple:!1,addbutton:".add-button",editbutton:".edit-button",removebutton:".remove-button",linkurl:".link-url",linklabel:".link-label",modal:"find-posts",overlay:".ui-find-overlay",source:"template-id"};return this.each(function(){o&&i.extend(t,o),new e(i(this),t)})}};i.fn.dionysosWordpress=function(o){return t[o]?t[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?(i.error("Method "+o+" does not exist on dionysosWordpress"),!1):t.init.apply(this,arguments)}}(window.jQuery,window.wp);